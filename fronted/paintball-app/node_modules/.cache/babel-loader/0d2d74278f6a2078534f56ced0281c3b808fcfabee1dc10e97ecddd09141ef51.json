{"ast":null,"code":"require(\"dotenv\").config();\nconst cors = require(\"cors\");\nconst mongoose = require(\"mongoose\");\nmongoose.set(\"strictQuery\", true);\nmongoose.connect(\"mongodb://127.0.0.1/paintball-activities\").then(() => console.log(\"connected to mongo\")).catch(() => console.log(\"could not connect to mongo\"));\nconst express = require(\"express\");\nconst morgan = require(\"morgan\");\nconst usersRouter = require(\"./routes/usersRoute\");\nconst authRouter = require(\"./routes/auth\");\nconst cardAuth = require(\"./routes/card.auth\");\nconst app = express();\napp.use(cors());\napp.use(morgan(\"dev\"), express.json());\napp.use(\"/users\", usersRouter);\napp.use(\"/auth\", authRouter);\napp.use(\"/cards\", cardAuth);\nconst {\n  ActivityCard,\n  generateBuisnessNumber\n} = require(\"./models/cards.model\");\nconst authMW = require(\"./middlewares/auth\");\nconst jwt = require(\"jsonwebtoken\");\nconst {\n  JWTSecretToken\n} = require(\"./configs/config\");\nconst {\n  User,\n  validateUser\n} = require(\"./models/users\");\nlet tasks = [];\nconsole.log(tasks);\napp.get(\"/api/tasks\", async (req, res) => {\n  tasks = await ActivityCard.find({});\n  const token = req.header(\"x-auth-token\");\n  // console.log(req.header(\"x-auth-token\"));\n  console.log(token);\n  if (!token) {\n    res.status(200).json(tasks);\n    return;\n  }\n  try {\n    const payload = jwt.verify(token, JWTSecretToken);\n    req.user = payload;\n    console.log(\"payload\", payload);\n    console.log(\"user id is:\", req.user._id);\n    const user = await User.findOne({\n      user_id: req.user._id\n    }, {\n      password: 0\n    });\n    console.log(user);\n    res.send({\n      user: user,\n      tasks: tasks\n    });\n  } catch {\n    res.status(400).send(\"invalid token\");\n  }\n});\napp.post(\"/api/tasks\", async (req, res) => {\n  // const { error } = validateCard(req.body);\n  // if (error) {\n  //   res.status(400).send(error.details[0].message);\n  //   return;\n  // }\n\n  const activityCard = await new ActivityCard({\n    ...req.body,\n    activityImage: req.body.activityImage || \"https://cdn.pixabay.com/photo/2017/11/10/05/48/user-2935527_960_720.png\",\n    activityNumber: await generateBuisnessNumber(),\n    user_id: req.body.phoneNumber,\n    isPaid: false,\n    inCalendar: false\n  }).save();\n  const newTask = activityCard;\n  tasks.push(newTask);\n  console.log(`new tack is ${newTask}`);\n  res.status(201).json(tasks);\n});\nconst PORT = 3003;\napp.listen(PORT, () => console.log(`listening on port ${PORT}`));","map":{"version":3,"names":["require","config","cors","mongoose","set","connect","then","console","log","catch","express","morgan","usersRouter","authRouter","cardAuth","app","use","json","ActivityCard","generateBuisnessNumber","authMW","jwt","JWTSecretToken","User","validateUser","tasks","get","req","res","find","token","header","status","payload","verify","user","_id","findOne","user_id","password","send","post","activityCard","body","activityImage","activityNumber","phoneNumber","isPaid","inCalendar","save","newTask","push","PORT","listen"],"sources":["C:/Users/sagil/OneDrive/מסמכים/paintball-application/paintball-application/fronted/paintball-app/src/components/calendar.jsx"],"sourcesContent":["require(\"dotenv\").config();\r\nconst cors = require(\"cors\");\r\nconst mongoose = require(\"mongoose\");\r\n\r\nmongoose.set(\"strictQuery\", true);\r\nmongoose\r\n  .connect(\"mongodb://127.0.0.1/paintball-activities\")\r\n  .then(() => console.log(\"connected to mongo\"))\r\n  .catch(() => console.log(\"could not connect to mongo\"));\r\n\r\nconst express = require(\"express\");\r\nconst morgan = require(\"morgan\");\r\nconst usersRouter = require(\"./routes/usersRoute\");\r\nconst authRouter = require(\"./routes/auth\");\r\nconst cardAuth = require(\"./routes/card.auth\");\r\n\r\nconst app = express();\r\napp.use(cors());\r\napp.use(morgan(\"dev\"), express.json());\r\napp.use(\"/users\", usersRouter);\r\napp.use(\"/auth\", authRouter);\r\napp.use(\"/cards\", cardAuth);\r\nconst {\r\n  ActivityCard,\r\n  generateBuisnessNumber,\r\n} = require(\"./models/cards.model\");\r\n\r\nconst authMW = require(\"./middlewares/auth\");\r\nconst jwt = require(\"jsonwebtoken\");\r\nconst { JWTSecretToken } = require(\"./configs/config\");\r\nconst { User, validateUser } = require(\"./models/users\");\r\n\r\nlet tasks = [];\r\n\r\nconsole.log(tasks);\r\n\r\napp.get(\"/api/tasks\", async (req, res) => {\r\n  tasks = await ActivityCard.find({});\r\n  const token = req.header(\"x-auth-token\");\r\n  // console.log(req.header(\"x-auth-token\"));\r\n  console.log(token);\r\n  if (!token) {\r\n    res.status(200).json(tasks);\r\n    return;\r\n  }\r\n  try {\r\n    const payload = jwt.verify(token, JWTSecretToken);\r\n    req.user = payload;\r\n    console.log(\"payload\", payload);\r\n    console.log(\"user id is:\", req.user._id);\r\n    const user = await User.findOne({ user_id: req.user._id }, { password: 0 });\r\n    console.log(user);\r\n    res.send({ user: user, tasks: tasks });\r\n  } catch {\r\n    res.status(400).send(\"invalid token\");\r\n  }\r\n});\r\n\r\napp.post(\"/api/tasks\", async (req, res) => {\r\n  // const { error } = validateCard(req.body);\r\n  // if (error) {\r\n  //   res.status(400).send(error.details[0].message);\r\n  //   return;\r\n  // }\r\n\r\n  const activityCard = await new ActivityCard({\r\n    ...req.body,\r\n    activityImage:\r\n      req.body.activityImage ||\r\n      \"https://cdn.pixabay.com/photo/2017/11/10/05/48/user-2935527_960_720.png\",\r\n    activityNumber: await generateBuisnessNumber(),\r\n    user_id: req.body.phoneNumber,\r\n    isPaid: false,\r\n    inCalendar: false,\r\n  }).save();\r\n\r\n  const newTask = activityCard;\r\n  tasks.push(newTask);\r\n  console.log(`new tack is ${newTask}`);\r\n  res.status(201).json(tasks);\r\n});\r\n\r\nconst PORT = 3003;\r\napp.listen(PORT, () => console.log(`listening on port ${PORT}`));\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}